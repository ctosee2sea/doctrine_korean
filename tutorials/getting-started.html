<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting Started with Doctrine &mdash; Doctrine 2 ORM 2 documentation</title>
    <link rel="stylesheet" href="../src/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../src/default.css" type="text/css" />
    <link rel="stylesheet" href="../src/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../src/layout.css" type="text/css" />
    <link rel="stylesheet" href="../src/configurationblock.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script type="text/javascript" src="../src/jquery.js"></script>
    <script type="text/javascript" src="../src/configurationblock.js"></script>
    <script type="text/javascript" src="../src/underscore.js"></script>
    <script type="text/javascript" src="../src/configurationblock.js"></script>
    <script type="text/javascript" src="../src/doctools.js"></script>
    <script type="text/javascript" src="../src/configurationblock.js"></script>
    <script src="../src/bootstrap.min.js"></script>

    <script type="text/javascript">
    <!--
        $(document).ready(function() {
            $("#versions").change(function() {
                var docsUrl = $(this).val();
                window.location.href = docsUrl;
            });
        });
    -->
    </script>
    <link rel="shortcut icon" href="../src/doctrine.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Doctrine 2 ORM 2 documentation" href="../index.html" />
    <link rel="next" title="Getting Started: Database First" href="getting-started-database.html" />
    <link rel="prev" title="Welcome to Doctrine 2 ORM’s documentation!" href="../index.html" /> 
  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/tutorials/getting-started.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../src/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'tutorials/getting-started' 		
READTHEDOCS_DATA['source_suffix'] = '.rst'
</script>

<script type="text/javascript" src="../src/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>
  <body>
    <div id="wrapper">
      <div id="header">
        <h1 id="h1title"></h1>
        <div id="logo">
          <a href="http://www.doctrine-project.org/">Doctrine - PHP Database Libraries</a>
        </div>
      </div>
      <div id="nav" class="cls">
        <div class="tl cls">
          <ul>
            <li><a target="_top" href="http://www.doctrine-project.org/">Home</a></li>
            <li><a target="_top" href="http://www.doctrine-project.org/about.html">About</a></li>
            <li><a target="_top" href="http://www.doctrine-project.org/projects.html">Projects</a></li>
            <li><a target="_top" href="http://www.doctrine-project.org/contribute.html">Contribute</a></li>
            <li><a target="_top" href="http://www.doctrine-project.org/community.html">Community</a></li>
            <li><a target="_top" href="http://www.doctrine-project.org/archive.html">Blog</a></li>
            <li><a target="_top" href="http://www.doctrine-project.org/jira">Development</a></li>
          </ul>
        </div>
      </div>
      <div id="content" class="cls">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="getting-started-database.html" title="Getting Started: Database First"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Welcome to Doctrine 2 ORM’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="/">Doctrine Homepage</a> &raquo;</li>
        <li><a href="../index.html">Doctrine 2 ORM 2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

        <div class="document">
            <div class="documentwrapper">
                <div class="bodywrapper">

              <div class="body" >
                
  <div class="section" id="getting-started-with-doctrine">
<h1>독트린 시작하기<a class="headerlink" href="#getting-started-with-doctrine" title="Permalink to this headline">¶</a></h1>
<p>이 안내서는 독트린 ORM을 시작하는 방법을 다룹니다. 학습 목표는 아래와 같습니다.</p>
<ul class="simple">
<li>독트린을 데이터베이스에 연결하여 설치하고 구성할 줄 안다.</li>
<li>PHP 객체를 데이터베이스 테이블에 매핑 시킨다.</li>
<li>PHP 객체에서 데이터베이스 스키마를 생성한다.</li>
<li><code class="docutils literal"><span class="pre">EntityManager</span></code>를 사용하여 데이터베이스에서 객체를 삽입, 수정, 삭제 및 찾기를 할 수 있다.</li>
</ul>
<div class="section" id="guide-assumptions">
<h2>안내서의 요구 사항<a class="headerlink" href="#guide-assumptions" title="Permalink to this headline">¶</a></h2>
<p>이 안내서는 이전에 독트린 ORM을 사용해보지 않은 초보자를 대상으로 합니다. <br />
이 튜토리얼을 위해 설치해야 할 것들이 몇 가지 있습니다.</p>
<ul class="simple">
<li>PHP (안정적인 최신 버젼)</li>
<li>컴포져 패키지 매니져 (<a class="reference external" href="http://getcomposer.org/doc/00-intro.md">컴포져 설치</a>)</li>
</ul>
<p>이 튜토리얼의 코드는 <a class="reference external" href="https://github.com/doctrine/doctrine2-orm-tutorial">깃허브에 있습니다.</a>.</p>
<div class="admonition note">
<p class="first admonition-title">노트</p>
<p class="last">이 튜토리얼은 <strong>독트린 2.4</strong> 이상에서 작업해야 합니다. <br />
일부 코드는 하위버젼에서 작동하지 않을 수 있습니다.</p>
</div>
</div>
<div class="section" id="what-is-doctrine">
<h2>독트린은 무엇인가?<a class="headerlink" href="#what-is-doctrine" title="Permalink to this headline">¶</a></h2>
<p>독트린 2는 PHP 객체에 투명한 영속성을 부여하는 PHP 5.4+ 용 <a class="reference external" href="http://en.wikipedia.org/wiki/Object-relational_mapping">객체 관계형 매퍼 (ORM)</a>입니다. <br />
관계형 데이터베이스 시스템 안에서 도메인/비즈니스 로직과 영속성을 완전히 분리시키기 위해 데이터 매퍼 패턴을 중점적으로 사용합니다.</p>
<p>프로그래머가 객체 지향 비즈니스 로직에 집중하고, 영속성은 부차적인 문제로 만드는 것이 독트린의 장점입니다. <br />
독트린 내에서 영속성이 중요하지 않다는 의미가 아니라, 영속성과 엔티티가 분리되어 있을 때 OOP의 이점을 살릴 수 있다는 믿음입니다.</p>
<div class="section" id="what-are-entities">
<h3>엔티티는 무엇인가?<a class="headerlink" href="#what-are-entities" title="Permalink to this headline">¶</a></h3>
<p>엔티티는 고유 Id나 기본키로 요청하여 식별할 수 있는 PHP 객체 입니다. <br />
이 클래스는 추상 기본 클래스나 인터페이스로 확장할 필요가 없습니다. <br />
엔티티 클래스는 최종 클래스이거나 최종 메소드를 포함할 수 없습니다. <br />
게다가 엔티티는 <a class="reference internal" href="../cookbook/implementing-wakeup-or-clone.html"><span class="doc">아주 안전하게</span></a> 하지 않는 한 <strong>복제</strong>나 <strong>깨우기</strong>를 구현할 수 없습니다. <br />
</p>
<p>엔티티는 영속적인 속성을 포함합니다. <br />
영속적인 속성은 독트린의 데이터 매핑 기능을 통해 데이터베이스에 저장되고, 데이터베이스에서 검색할 수 있는 엔티티의 인스턴스 변수입니다.</p>
</div>
</div>
<div class="section" id="an-example-model-bug-tracker">
<h2>예제 모델 : 버그 추적기<a class="headerlink" href="#an-example-model-bug-tracker" title="Permalink to this headline">¶</a></h2>
<p>독트린 시작하기 가이드를 통해 우리는 <a class="reference external" href="http://framework.zend.com/manual/1.12/en/zend.db.adapter.html">Zend_Db_Table</a> 문서에서 버그 추적기 도메인 모델을 구현할 것입니다. <br />
이 문서를 읽으면서 우리는 이러한 요구사항을 도출할 수 있습니다.</p>
<ul class="simple">
<li>각 버그는 설명, 생성 날짜, 상태, 보고자, 엔지니어가 있습니다.</li>
<li>버그는 다른 제품(이나 플랫폼)에서 발생할 수 있습니다.</li>
<li>각 제품은 이름이 있습니다.</li>
<li>버그 보고자와 엔지니어는 모두 시스템 유저입니다.</li>
<li>각 사용자는 새로운 버그를 만들 수 있습니다.</li>
<li>할당받은 엔지니어가 버그를 종료시킬 수 있습니다.</li>
<li>각 유저는 자신이 보고하였거나 할당받은 버그를 볼 수 있습니다.</li>
<li>버그는 list-view를 통해 페이징 할 수 있습니다.</li>
</ul>
</div>
<div class="section" id="project-setup">
<h2>프로젝트 설정<a class="headerlink" href="#project-setup" title="Permalink to this headline">¶</a></h2>
<p>이 튜토리얼 프로젝트를 위해 <code class="docutils literal"><span class="pre">doctrine2-tutorial</span></code> 같은 이름의 새로운 빈 폴더를 만들고, 아래의 내용을 담은 <code class="docutils literal"><span class="pre">composer.json</span></code> 파일을 생성하세요.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;require&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;doctrine/orm&quot;</span><span class="p">:</span> <span class="s2">&quot;2.4.*&quot;</span><span class="p">,</span>
        <span class="s2">&quot;symfony/yaml&quot;</span><span class="p">:</span> <span class="s2">&quot;2.*&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;autoload&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;psr-0&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="s2">&quot;src/&quot;</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>컴포저 의존성 관리 도구로 다음을 호출하여 독트린을 설치합니다.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ composer install
</pre></div>
</div>
<p>독트린 공통 패키지, DBAL, ORM, 심포니 YAML, 심포니 콘솔이 <cite>vendor</cite> 폴더에 설치될 것입니다. <br />
심포니 의존성은 필수가 아니지만, 이 튜토리얼에서는 사용합니다.</p>
<p>다음 폴더들을 추가하십시오.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>doctrine2-tutorial
|-- config
|   |-- xml
|   `-- yaml
`-- src
</pre></div>
</div>
</div>
<div class="section" id="obtaining-the-entitymanager">
<h2>EntityManager 취득하기<a class="headerlink" href="#obtaining-the-entitymanager" title="Permalink to this headline">¶</a></h2>
<p>독트린의 공용 인터페이스는 EntityManager 입니다. <br />
EntityManager는 엔티티와 엔티티 영속성 변경등의 전체 라이프사이클 관리를 위한 액세스 포인트를 제공합니다. <br />
독트린 2에서 엔티티를 사용하기 위해서는 엔티티를 구성하고 생성해야 합니다. <br />
이제 구성 단계를 보여주고, 단계별로 살펴 보겠습니다.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// bootstrap.php</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\Tools\Setup</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityManager</span><span class="p">;</span>

<span class="k">require_once</span> <span class="s2">&quot;vendor/autoload.php&quot;</span><span class="p">;</span>

<span class="c1">// 주석 달기를 위한 간단한 '기본적인' 독트린 ORM 구성 생성</span>
<span class="c1">// Create a simple &quot;default&quot; Doctrine ORM configuration for Annotations</span>
<span class="nv">$isDevMode</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="nx">Setup</span><span class="o">::</span><span class="na">createAnnotationMetadataConfiguration</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="no">__DIR__</span><span class="o">.</span><span class="s2">&quot;/src&quot;</span><span class="p">),</span> <span class="nv">$isDevMode</span><span class="p">);</span>
<span class="c1">// 아니면 yaml이나 XML을 사용하기 위해 아래의 코드 사용</span>
<span class="c1">// or if you prefer yaml or XML</span>
<span class="c1">//$config = Setup::createXMLMetadataConfiguration(array(__DIR__.&quot;/config/xml&quot;), $isDevMode);</span>
<span class="c1">//$config = Setup::createYAMLMetadataConfiguration(array(__DIR__.&quot;/config/yaml&quot;), $isDevMode);</span>

<span class="c1">// 데이터베이스 구성 매개변수</span>
<span class="c1">// database configuration parameters</span>
<span class="nv">$conn</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pdo_sqlite&#39;</span><span class="p">,</span>
    <span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/db.sqlite&#39;</span><span class="p">,</span>
<span class="p">);</span>

<span class="c1">// 엔티티 관리자 취득</span>
<span class="c1">// obtaining the entity manager</span>
<span class="nv">$entityManager</span> <span class="o">=</span> <span class="nx">EntityManager</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span>
</pre></div>
</div>
<p>첫 번째 require 구분은 컴포저 오토로드를 사용해서 독트린 오토로딩 기능을 설정합니다.</p>
<p>두 번째 블록은 설치 도우미를 사용한 ORM <code class="docutils literal"><span class="pre">Configuration</span></code> 객체의 예시로 구성되어 있습니다. <br />
이것은 지금 당장은 신경쓰지 않아도 되는 기본값들을 처리합니다. <br />
<a class="reference internal" href="../reference/configuration.html"><span class="doc">구성에 대한 레퍼전스 장</span></a>에서 구성 상세를 읽을 수 있습니다.
</p>
<p>세 번째 블럭은 데이터베이스 연결을 위한 구성 옵션 요구사항들입니다. 이 경우에는 파일 기반의 sqlite 데이터베이스입니다. <br />
연결 가능한 다른 드라이버들에 대한 구성 옵션들은 <a class="reference external" href="http://docs.doctrine-project.org/projects/doctrine-dbal/en/latest/">DBAL 구성 섹션 메뉴얼</a>에 있습니다. </p>
<p>마지막 블록은 factory 메소드에서 <code class="docutils literal"><span class="pre">EntityManager</span></code>을 취득하는 법을 보여줍니다.</p>
</div>
<div class="section" id="generating-the-database-schema">
<h2>데이터베이스 스키마 생성<a class="headerlink" href="#generating-the-database-schema" title="Permalink to this headline">¶</a></h2>
<p>이제 우리는 메타 데이터 매핑을 정의하고, 우리가 생성하기 원하는 관계형 데이터베이스 스키마를 불러올 EntityManager를 로딩(bootstrap)할 것입니다. <br />
독트린에는 메타데이터 작업에 필요한 테이블을 생성하는 컴포넌트인 SchemaTool에 접근할 수 있는 CLI(Command-Line Interface)가 있습니다.</p>
<p>CLI가 작동하려면 cli-config.php 파일이 독트린 명령어를 실행할 프로젝트의 루트 디렉토리에 위치해야 합니다. 이건 상당히 간단한 파일입니다.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// cli-config.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">\Doctrine\ORM\Tools\Console\ConsoleRunner</span><span class="o">::</span><span class="na">createHelperSet</span><span class="p">(</span><span class="nv">$entityManager</span><span class="p">);</span>
</pre></div>
</div>
<p>그러면 프로젝트 폴더 안으로 이동해서 독트린 명령줄 도구를 사용할 수 있습니다.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd project/
$ vendor/bin/doctrine orm:schema-tool:create
</pre></div>
</div>
<p>이 시점에서 <cite>src</cite>에 엔티티 메타데이터가 없으므로 &#8220;No Metadata Classes to process.&#8221; 라는 메시지가 표시됩니다. 다음 섹션에서 Product 엔티티와 해당 메타데이터를 생성할 것이기 때문에 걱정하지 않으셔도 됩니다.</p>
<p>개발 프로세스 중에 주기적으로 엔티티 메타데이터와 동기화되도록 데이터베이스 스키마를 업데이트 해야 한다는 점을 잊지 마세요.</p>
<p>다음과 같이 데이터베이스를 손쉽게 재생성할 수 있습니다.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ vendor/bin/doctrine orm:schema-tool:drop --force
$ vendor/bin/doctrine orm:schema-tool:create
</pre></div>
</div>
<p>혹은 업데이트 기능을 사용할 수 있습니다.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ vendor/bin/doctrine orm:schema-tool:update --force
</pre></div>
</div>
<p>데이터베이스 업데이트시, 독트린 ORM 패키지 없이도 사용할 수 있는 <code class="docutils literal"><span class="pre">Doctrine\DBAL</span></code> 패키지의 기본 데이터베이스 스키마에 대해 Diff 알고리즘이 사용됩니다.</p>
</div>
<div class="section" id="starting-with-the-product">
<h2>Product 시작하기<a class="headerlink" href="#starting-with-the-product" title="Permalink to this headline">¶</a></h2>
<p>우리는 가장 간단한 엔티티 Product부터 시작합니다. <br />
<code class="docutils literal"><span class="pre">src/Product.php</span></code> 파일을 작성해서 다음의 <code class="docutils literal"><span class="pre">Product</span></code> 엔티티 정의를 포함시키십시오.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/Product.php</span>
<span class="k">class</span> <span class="nc">Product</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var int</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="sd">/**</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>$id를 제외한 모든 필드는 변경자(getter,setter mutator)가 정의한 protected (public이 아니라)로 설정된다는 점을 유의하세요. <br />
변경자를 사용하면 독트린이 엔티티를 조작하는 호출에 연결할 수 있습니다. [주 : 훅을 걸 수 있습니다.] <br />
이런 기능은 <code class="docutils literal"><span class="pre">entity#field</span> <span class="pre">=</span> <span class="pre">foo;</span></code> 과 같은 방식으로 값을 직접 설정했을 때는 불가능합니다.</p>
<p>id 필드에는 setter 가 없습니다. 일반적으로 이것은 데이터베이스의 id 값을 가리키기 때문에 설정하는 코드를 짜서는 안됩니다. <br />
(독트린 자체는 여전히 정의된 setter 함수 대신 Reflection API를 사용하여 값을 설정할 수 있습니다.)</p>
<p>독트린의 영속성을 위한 다음 단계는 메타데이터 언어를 사용하여 <code class="docutils literal"><span class="pre">Product</span></code> 엔티티의 구조를 독트린에 설명하는 것입니다. <br />
메타데이터 언어는 엔티티가 속성과 참조가 어떻게 영속적이 되는지, 무엇이 적용에 제한되는지 설명합니다. </p>
<p>엔티티 메타데이터는 XML, YAML 혹은 파일 내 주석블럭을 사용하여 구성됩니다. <br />
이 시작 안내서는 모든 매핑 드라이버의 매핑 방법을 보여줍니다. <br />
텍스트 내부 참조는 XML 매핑으로 만들어집니다. </p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/Product.php</span>
<span class="sd">/**</span>
<span class="sd"> * @Entity @Table(name=&quot;products&quot;)</span>
<span class="sd"> **/</span>
<span class="k">class</span> <span class="nc">Product</span>
<span class="p">{</span>
    <span class="sd">/** @Id @Column(type=&quot;integer&quot;) @GeneratedValue **/</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="sd">/** @Column(type=&quot;string&quot;) **/</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="c1">// .. (other code)</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/xml/Product.dcm.xml --&gt;</span>
<span class="nt">&lt;doctrine-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping&quot;</span>
      <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping</span>
<span class="s">                    http://raw.github.com/doctrine/doctrine2/master/doctrine-mapping.xsd&quot;</span><span class="nt">&gt;</span>

      <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;Product&quot;</span> <span class="na">table=</span><span class="s">&quot;products&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;id</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">type=</span><span class="s">&quot;integer&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;generator</span> <span class="na">strategy=</span><span class="s">&quot;AUTO&quot;</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/id&gt;</span>

          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/doctrine-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># config/yaml/Product.dcm.yml</span>
<span class="l l-Scalar l-Scalar-Plain">Product</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">entity</span>
  <span class="l l-Scalar l-Scalar-Plain">table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">products</span>
  <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="l l-Scalar l-Scalar-Plain">generator</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">strategy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AUTO</span>
  <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>최상위 레벨 <code class="docutils literal"><span class="pre">entity</span></code> 정의 태그는 클래스와 테이블 이름 정보를 지정합니다. <br />
초기 타입 <code class="docutils literal"><span class="pre">Product#name</span></code>은 <code class="docutils literal"><span class="pre">field</span></code> 속성으로 정의됩니다. <br />
<code class="docutils literal"><span class="pre">id</span></code> 속성은 <code class="docutils literal"><span class="pre">id</span></code> 태그로 정의되는데, 이 태그는 <code class="docutils literal"><span class="pre">generator</span></code>도 갖습니다. 이 <code class="docutils literal"><span class="pre">generator</span></code> 태그는 자동으로 데이터베이스 플랫폼의 네이티브 id 생성 기능을 기본키 생성 메카니즘으로 사용하도록 정의합니다. (예 : Mysql의 AUTO INCREMENT, PostgreSql과 Oracle의 Sequences)
</p>
<p>첫 번째 엔티티를 정의했으니, 데이터베이스를 업데이트 해봅시다.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ vendor/bin/doctrine orm:schema-tool:update --force --dump-sql
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">--force</span></code>와 <code class="docutils literal"><span class="pre">--dump-sql</span></code> 플래그를 모두 지정하고 DDL 구문을 실행합니다.</p>
<p>이제 데이터베이스에 제품들을 입력하는 스크립트를 작성하겠습니다.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// create_product.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$newProductName</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nv">$product</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Product</span><span class="p">();</span>
<span class="nv">$product</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="nv">$newProductName</span><span class="p">);</span>

<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$product</span><span class="p">);</span>
<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

<span class="k">echo</span> <span class="s2">&quot;Created Product with ID &quot;</span> <span class="o">.</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>CLI에서 이 스크립트를 호출해서 신제품이 생성되는 것을 확인하십시오.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ php create_product.php ORM
$ php create_product.php DBAL
</pre></div>
</div>
<p>어떤 일이 벌어졌죠? <code class="docutils literal"><span class="pre">Product</span></code>를 사용한 것은 상당히 OOP 적입니다. <br />
흥미로운 점은 <code class="docutils literal"><span class="pre">EntityManager</span></code> 서비스를 사용한다는 점입니다. <br />
EntityManager에게 새로운 엔티티를 데이터베이스에 입력한다는 것을 알리기 위해, <code class="docutils literal"><span class="pre">persist()</span></code>를 호출해야 합니다. <br />
실제로 트랜잭션을 실행해서 입력하려면, EntityManager상에서 <code class="docutils literal"><span class="pre">flush()</span></code>을 명시하여 호출해야 합니다.
</p>
<p>하나의 트랜잭션 안에 모든 작성문(insert,update,delete)를 집계하고, flush가 호출될 때 이를 실행한다는 것이 persist와 flush의 차이점입니다. <br />
이 접근 방식을 사용하는 것이, 각 엔티티를 개별적으로 업데이트 하는 것보다 성능면에서 낫습니다.</p>
<p>독트린은 요청 중에 호출되고 변경된 모든 엔티티를 감지하는 작업 단위 패턴을 따릅니다. <br />
독트린이 이미 감지하고 있기 때문에, 일부러 엔티티를 추적할 필요는 없습니다.</p>
<p>다음으로 모든 제품 목록을 불러오겠습니다. <br />
다음 스크립트를 작성하겠습니다.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// list_products.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$productRepository</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;Product&#39;</span><span class="p">);</span>
<span class="nv">$products</span> <span class="o">=</span> <span class="nv">$productRepository</span><span class="o">-&gt;</span><span class="na">findAll</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$products</span> <span class="k">as</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;-%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">EntityManager#getRepository()</span></code> 메소드는 모든 엔티티에 대한 파인더 객체(저장소라 불림)를 생성합니다. <br />
이것은 독트린에서 제공하는 기능이며, <code class="docutils literal"><span class="pre">findAll()</span></code> 과 같은 파인더 메소드가 포함되어 있습니다.</p>
<p>ID를 기반으로 제품 이름을 표시해보겠습니다.</p> 
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// show_product.php &lt;id&gt;</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;Product&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$product</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;No product found.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;-%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">());</span>
</pre></div>
</div>
<p>제품 이름을 업데이트해보면 앞에서 설명한 작업 단위 패턴 기능을 알 수 있습니다. <br />
우리가 그저 제품 엔티티만 찾으면, 그 속성에 대한 모든 변경 사항이 데이터베이스에 기록됩니다.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// update_product.php &lt;id&gt; &lt;new-name&gt;</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$newName</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;Product&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$product</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Product </span><span class="si">$id</span><span class="s2"> does not exist.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$product</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="nv">$newName</span><span class="p">);</span>

<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</pre></div>
</div>
<p>이 스크립트로 이미 존재하는 제품 하나를 호출한 후 , <code class="docutils literal"><span class="pre">show_product.php</span></code>를 사용하여 제품 이름이 변경되었음을 확인할 수 있습니다.</p>
</div>
<div class="section" id="adding-bug-and-user-entities">
<h2>버그 및 사용자 엔티티 추가하기<a class="headerlink" href="#adding-bug-and-user-entities" title="Permalink to this headline">¶</a></h2>

<p>버그 추적기 개발을 계속하기 위해,
<code class="docutils literal"><span class="pre">Bug</span></code>와 <code class="docutils literal"><span class="pre">User</span></code>가 없는 클래스를 생성하여, 그것들을 각각 <code class="docutils literal"><span class="pre">src/Bug.php</span></code> 와
<code class="docutils literal"><span class="pre">src/User.php</span></code>에 입력합니다.</p>

<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/Bug.php</span>
<span class="sd">/**</span>
<span class="sd"> * @Entity(repositoryClass=&quot;BugRepository&quot;) @Table(name=&quot;bugs&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Bug</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Id @Column(type=&quot;integer&quot;) @GeneratedValue</span>
<span class="sd">     * @var int</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;)</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$description</span><span class="p">;</span>
    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;datetime&quot;)</span>
<span class="sd">     * @var DateTime</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$created</span><span class="p">;</span>
    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;)</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$status</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescription</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">description</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setDescription</span><span class="p">(</span><span class="nv">$description</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">description</span> <span class="o">=</span> <span class="nv">$description</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setCreated</span><span class="p">(</span><span class="nx">DateTime</span> <span class="nv">$created</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">created</span> <span class="o">=</span> <span class="nv">$created</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCreated</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">created</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setStatus</span><span class="p">(</span><span class="nv">$status</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status</span> <span class="o">=</span> <span class="nv">$status</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getStatus</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/User.php</span>
<span class="sd">/**</span>
<span class="sd"> * @Entity @Table(name=&quot;users&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Id @GeneratedValue @Column(type=&quot;integer&quot;)</span>
<span class="sd">     * @var int</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;)</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p></p>
<p>All of the properties discussed so far are simple string and integer values,
for example the id fields of the entities, their names, description, status and
change dates. Next we will model the dynamic relationships between the entities
by defining the references between entities.</p>
<p>References between objects are foreign keys in the database. You never have to
(and never should) work with the foreign keys directly, only with the objects
that represent the foreign key through their own identity.</p>
<p>For every foreign key you either have a Doctrine ManyToOne or OneToOne
association. On the inverse sides of these foreign keys you can have
OneToMany associations. Obviously you can have ManyToMany associations
that connect two tables with each other through a join table with
two foreign keys.</p>
<p>Now that you know the basics about references in Doctrine, we can extend the
domain model to match the requirements:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/Bug.php</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Collections\ArrayCollection</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Bug</span>
<span class="p">{</span>
    <span class="c1">// ... (previous code)</span>

    <span class="k">protected</span> <span class="nv">$products</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">products</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayCollection</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/User.php</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Collections\ArrayCollection</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ... (previous code)</span>

    <span class="k">protected</span> <span class="nv">$reportedBugs</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$assignedBugs</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reportedBugs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayCollection</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assignedBugs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayCollection</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You use Doctrine&#8217;s ArrayCollections in your Doctrine models, rather
than plain PHP arrays, so that Doctrine can watch what happens with
them and act appropriately.  Note that if you dump your entities,
you&#8217;ll see a &#8220;PersistentCollection&#8221; in place of your ArrayCollection,
which is just an
internal Doctrine class with the same interface.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Lazy load proxies always contain an instance of
Doctrine&#8217;s EntityManager and all its dependencies. Therefore a
var_dump() will possibly dump a very large recursive structure
which is impossible to render and read. You have to use
<code class="docutils literal"><span class="pre">Doctrine\Common\Util\Debug::dump()</span></code> to restrict the dumping to a
human readable level. Additionally you should be aware that dumping
the EntityManager to a Browser may take several minutes, and the
Debug::dump() method just ignores any occurrences of it in Proxy
instances.</p>
</div>
<p>Because we only work with collections for the references we must be
careful to implement a bidirectional reference in the domain model.
The concept of owning or inverse side of a relation is central to
this notion and should always be kept in mind. The following
assumptions are made about relations and have to be followed to be
able to work with Doctrine 2. These assumptions are not unique to
Doctrine 2 but are best practices in handling database relations
and Object-Relational Mapping.</p>
<ul class="simple">
<li>Changes to Collections are saved or updated, when the entity on
the <em>owning</em> side of the collection is saved or updated.</li>
<li>Saving an Entity at the inverse side of a relation never
triggers a persist operation to changes to the collection.</li>
<li>In a one-to-one relation the entity holding the foreign key of
the related entity on its own database table is <em>always</em> the owning
side of the relation.</li>
<li>In a many-to-many relation, both sides can be the owning side of
the relation. However in a bi-directional many-to-many relation
only one is allowed to be.</li>
<li>In a many-to-one relation the Many-side is the owning side by
default, because it holds the foreign key.</li>
<li>The OneToMany side of a relation is inverse by default, since
the foreign key is saved on the Many side. A OneToMany relation can
only be the owning side, if its implemented using a ManyToMany
relation with join table and restricting the one side to allow only
UNIQUE values per database constraint.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Consistency of bi-directional references on the inverse side of a
relation have to be managed in userland application code. Doctrine
cannot magically update your collections to be consistent.</p>
</div>
<p>In the case of Users and Bugs we have references back and forth to
the assigned and reported bugs from a user, making this relation
bi-directional. We have to change the code to ensure consistency of
the bi-directional reference:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/Bug.php</span>
<span class="k">class</span> <span class="nc">Bug</span>
<span class="p">{</span>
    <span class="c1">// ... (previous code)</span>

    <span class="k">protected</span> <span class="nv">$engineer</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$reporter</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setEngineer</span><span class="p">(</span><span class="nv">$engineer</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$engineer</span><span class="o">-&gt;</span><span class="na">assignedToBug</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">engineer</span> <span class="o">=</span> <span class="nv">$engineer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setReporter</span><span class="p">(</span><span class="nv">$reporter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$reporter</span><span class="o">-&gt;</span><span class="na">addReportedBug</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reporter</span> <span class="o">=</span> <span class="nv">$reporter</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getEngineer</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">engineer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getReporter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reporter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/User.php</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ... (previous code)</span>

    <span class="k">protected</span> <span class="nv">$reportedBugs</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$assignedBugs</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addReportedBug</span><span class="p">(</span><span class="nv">$bug</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">reportedBugs</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$bug</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">assignedToBug</span><span class="p">(</span><span class="nv">$bug</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assignedBugs</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$bug</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>I chose to name the inverse methods in past-tense, which should
indicate that the actual assigning has already taken place and the
methods are only used for ensuring consistency of the references.
This approach is my personal preference, you can choose whatever
method to make this work.</p>
<p>You can see from <code class="docutils literal"><span class="pre">User#addReportedBug()</span></code> and
<code class="docutils literal"><span class="pre">User#assignedToBug()</span></code> that using this method in userland alone
would not add the Bug to the collection of the owning side in
<code class="docutils literal"><span class="pre">Bug#reporter</span></code> or <code class="docutils literal"><span class="pre">Bug#engineer</span></code>. Using these methods and
calling Doctrine for persistence would not update the collections
representation in the database.</p>
<p>Only using <code class="docutils literal"><span class="pre">Bug#setEngineer()</span></code> or <code class="docutils literal"><span class="pre">Bug#setReporter()</span></code>
correctly saves the relation information.</p>
<p>The <code class="docutils literal"><span class="pre">Bug#reporter</span></code> and <code class="docutils literal"><span class="pre">Bug#engineer</span></code> properties are
Many-To-One relations, which point to a User. In a normalized
relational model the foreign key is saved on the Bug&#8217;s table, hence
in our object-relation model the Bug is at the owning side of the
relation. You should always make sure that the use-cases of your
domain model should drive which side is an inverse or owning one in
your Doctrine mapping. In our example, whenever a new bug is saved
or an engineer is assigned to the bug, we don&#8217;t want to update the
User to persist the reference, but the Bug. This is the case with
the Bug being at the owning side of the relation.</p>
<p>Bugs reference Products by an uni-directional ManyToMany relation in
the database that points from Bugs to Products.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/Bug.php</span>
<span class="k">class</span> <span class="nc">Bug</span>
<span class="p">{</span>
    <span class="c1">// ... (previous code)</span>

    <span class="k">protected</span> <span class="nv">$products</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">assignToProduct</span><span class="p">(</span><span class="nv">$product</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">products</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$product</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getProducts</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">products</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We are now finished with the domain model given the requirements.
Lets add metadata mappings for the <code class="docutils literal"><span class="pre">User</span></code> and <code class="docutils literal"><span class="pre">Bug</span></code> as we did for
the <code class="docutils literal"><span class="pre">Product</span></code> before:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/Bug.php</span>
<span class="sd">/**</span>
<span class="sd"> * @Entity @Table(name=&quot;bugs&quot;)</span>
<span class="sd"> **/</span>
<span class="k">class</span> <span class="nc">Bug</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Id @Column(type=&quot;integer&quot;) @GeneratedValue</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;)</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$description</span><span class="p">;</span>
    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;datetime&quot;)</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$created</span><span class="p">;</span>
    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;)</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$status</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ManyToOne(targetEntity=&quot;User&quot;, inversedBy=&quot;assignedBugs&quot;)</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$engineer</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ManyToOne(targetEntity=&quot;User&quot;, inversedBy=&quot;reportedBugs&quot;)</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$reporter</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ManyToMany(targetEntity=&quot;Product&quot;)</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$products</span><span class="p">;</span>

    <span class="c1">// ... (other code)</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/xml/Bug.dcm.xml --&gt;</span>
<span class="nt">&lt;doctrine-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping&quot;</span>
      <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping</span>
<span class="s">                    http://raw.github.com/doctrine/doctrine2/master/doctrine-mapping.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;Bug&quot;</span> <span class="na">table=</span><span class="s">&quot;bugs&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">type=</span><span class="s">&quot;integer&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;generator</span> <span class="na">strategy=</span><span class="s">&quot;AUTO&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/id&gt;</span>

        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;created&quot;</span> <span class="na">type=</span><span class="s">&quot;datetime&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;status&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;many-to-one</span> <span class="na">target-entity=</span><span class="s">&quot;User&quot;</span> <span class="na">field=</span><span class="s">&quot;reporter&quot;</span> <span class="na">inversed-by=</span><span class="s">&quot;reportedBugs&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;many-to-one</span> <span class="na">target-entity=</span><span class="s">&quot;User&quot;</span> <span class="na">field=</span><span class="s">&quot;engineer&quot;</span> <span class="na">inversed-by=</span><span class="s">&quot;assignedBugs&quot;</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;many-to-many</span> <span class="na">target-entity=</span><span class="s">&quot;Product&quot;</span> <span class="na">field=</span><span class="s">&quot;products&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/doctrine-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># config/yaml/Bug.dcm.yml</span>
<span class="l l-Scalar l-Scalar-Plain">Bug</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">entity</span>
  <span class="l l-Scalar l-Scalar-Plain">table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bugs</span>
  <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="l l-Scalar l-Scalar-Plain">generator</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">strategy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AUTO</span>
  <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">text</span>
    <span class="l l-Scalar l-Scalar-Plain">created</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">datetime</span>
    <span class="l l-Scalar l-Scalar-Plain">status</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
  <span class="l l-Scalar l-Scalar-Plain">manyToOne</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">reporter</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">targetEntity</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">User</span>
      <span class="l l-Scalar l-Scalar-Plain">inversedBy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">reportedBugs</span>
    <span class="l l-Scalar l-Scalar-Plain">engineer</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">targetEntity</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">User</span>
      <span class="l l-Scalar l-Scalar-Plain">inversedBy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">assignedBugs</span>
  <span class="l l-Scalar l-Scalar-Plain">manyToMany</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">products</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">targetEntity</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Product</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Here we have the entity, id and primitive type definitions.
For the &#8220;created&#8221; field we have used the <code class="docutils literal"><span class="pre">datetime</span></code> type,
which translates the YYYY-mm-dd HH:mm:ss database format
into a PHP DateTime instance and back.</p>
<p>After the field definitions the two qualified references to the
user entity are defined. They are created by the <code class="docutils literal"><span class="pre">many-to-one</span></code>
tag. The class name of the related entity has to be specified with
the <code class="docutils literal"><span class="pre">target-entity</span></code> attribute, which is enough information for
the database mapper to access the foreign-table. Since
<code class="docutils literal"><span class="pre">reporter</span></code> and <code class="docutils literal"><span class="pre">engineer</span></code> are on the owning side of a
bi-directional relation we also have to specify the <code class="docutils literal"><span class="pre">inversed-by</span></code>
attribute. They have to point to the field names on the inverse
side of the relationship. We will see in the next example that the <code class="docutils literal"><span class="pre">inversed-by</span></code>
attribute has a counterpart <code class="docutils literal"><span class="pre">mapped-by</span></code> which makes that
the inverse side.</p>
<p>The last definition is for the <code class="docutils literal"><span class="pre">Bug#products</span></code> collection. It
holds all products where the specific bug occurs. Again
you have to define the <code class="docutils literal"><span class="pre">target-entity</span></code> and <code class="docutils literal"><span class="pre">field</span></code> attributes
on the <code class="docutils literal"><span class="pre">many-to-many</span></code> tag.</p>
<p>The last missing definition is that of the User entity:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/User.php</span>
<span class="sd">/**</span>
<span class="sd"> * @Entity @Table(name=&quot;users&quot;)</span>
<span class="sd"> **/</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Id @GeneratedValue @Column(type=&quot;integer&quot;)</span>
<span class="sd">     * @var int</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @Column(type=&quot;string&quot;)</span>
<span class="sd">     * @var string</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @OneToMany(targetEntity=&quot;Bug&quot;, mappedBy=&quot;reporter&quot;)</span>
<span class="sd">     * @var Bug[]</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$reportedBugs</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @OneToMany(targetEntity=&quot;Bug&quot;, mappedBy=&quot;engineer&quot;)</span>
<span class="sd">     * @var Bug[]</span>
<span class="sd">     **/</span>
    <span class="k">protected</span> <span class="nv">$assignedBugs</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="c1">// .. (other code)</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/xml/User.dcm.xml --&gt;</span>
<span class="nt">&lt;doctrine-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping&quot;</span>
      <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping</span>
<span class="s">                    http://raw.github.com/doctrine/doctrine2/master/doctrine-mapping.xsd&quot;</span><span class="nt">&gt;</span>

     <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;User&quot;</span> <span class="na">table=</span><span class="s">&quot;users&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;id</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">type=</span><span class="s">&quot;integer&quot;</span><span class="nt">&gt;</span>
             <span class="nt">&lt;generator</span> <span class="na">strategy=</span><span class="s">&quot;AUTO&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;/id&gt;</span>

         <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span> <span class="nt">/&gt;</span>

         <span class="nt">&lt;one-to-many</span> <span class="na">target-entity=</span><span class="s">&quot;Bug&quot;</span> <span class="na">field=</span><span class="s">&quot;reportedBugs&quot;</span> <span class="na">mapped-by=</span><span class="s">&quot;reporter&quot;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;one-to-many</span> <span class="na">target-entity=</span><span class="s">&quot;Bug&quot;</span> <span class="na">field=</span><span class="s">&quot;assignedBugs&quot;</span> <span class="na">mapped-by=</span><span class="s">&quot;engineer&quot;</span> <span class="nt">/&gt;</span>
     <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/doctrine-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># config/yaml/User.dcm.yml</span>
<span class="l l-Scalar l-Scalar-Plain">User</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">entity</span>
  <span class="l l-Scalar l-Scalar-Plain">table</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">users</span>
  <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">id</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
      <span class="l l-Scalar l-Scalar-Plain">generator</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">strategy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">AUTO</span>
  <span class="l l-Scalar l-Scalar-Plain">fields</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
  <span class="l l-Scalar l-Scalar-Plain">oneToMany</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">reportedBugs</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">targetEntity</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bug</span>
      <span class="l l-Scalar l-Scalar-Plain">mappedBy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">reporter</span>
    <span class="l l-Scalar l-Scalar-Plain">assignedBugs</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">targetEntity</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Bug</span>
      <span class="l l-Scalar l-Scalar-Plain">mappedBy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">engineer</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Here are some new things to mention about the <code class="docutils literal"><span class="pre">one-to-many</span></code> tags.
Remember that we discussed about the inverse and owning side. Now
both reportedBugs and assignedBugs are inverse relations, which
means the join details have already been defined on the owning
side. Therefore we only have to specify the property on the Bug
class that holds the owning sides.</p>
<p>This example has a fair overview of the most basic features of the
metadata definition language.</p>
<p>Update your database running:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ vendor/bin/doctrine orm:schema-tool:update --force
</pre></div>
</div>
</div>
<div class="section" id="implementing-more-requirements">
<h2>Implementing more Requirements<a class="headerlink" href="#implementing-more-requirements" title="Permalink to this headline">¶</a></h2>
<p>For starters we need to create user entities:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// create_user.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$newUsername</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="nv">$newUsername</span><span class="p">);</span>

<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

<span class="k">echo</span> <span class="s2">&quot;Created User with ID &quot;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Now call:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ php create_user.php beberlei
</pre></div>
</div>
<p>We now have the data to create a bug and the code for this scenario may look
like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// create_bug.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$theReporterId</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$theDefaultEngineerId</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="nv">$productIds</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

<span class="nv">$reporter</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s2">&quot;User&quot;</span><span class="p">,</span> <span class="nv">$theReporterId</span><span class="p">);</span>
<span class="nv">$engineer</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s2">&quot;User&quot;</span><span class="p">,</span> <span class="nv">$theDefaultEngineerId</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$reporter</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$engineer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;No reporter and/or engineer found for the input.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$bug</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bug</span><span class="p">();</span>
<span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">setDescription</span><span class="p">(</span><span class="s2">&quot;Something does not work!&quot;</span><span class="p">);</span>
<span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">setCreated</span><span class="p">(</span><span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s2">&quot;now&quot;</span><span class="p">));</span>
<span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">setStatus</span><span class="p">(</span><span class="s2">&quot;OPEN&quot;</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$productIds</span> <span class="k">as</span> <span class="nv">$productId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$product</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s2">&quot;Product&quot;</span><span class="p">,</span> <span class="nv">$productId</span><span class="p">);</span>
    <span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">assignToProduct</span><span class="p">(</span><span class="nv">$product</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">setReporter</span><span class="p">(</span><span class="nv">$reporter</span><span class="p">);</span>
<span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">setEngineer</span><span class="p">(</span><span class="nv">$engineer</span><span class="p">);</span>

<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">persist</span><span class="p">(</span><span class="nv">$bug</span><span class="p">);</span>
<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>

<span class="k">echo</span> <span class="s2">&quot;Your new Bug Id: &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Since we only have one user and product, probably with the ID of 1, we can call this script with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">php</span> <span class="n">create_bug</span><span class="o">.</span><span class="n">php</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This is the first contact with the read API of the EntityManager,
showing that a call to <code class="docutils literal"><span class="pre">EntityManager#find($name,</span> <span class="pre">$id)</span></code> returns a
single instance of an entity queried by primary key. Besides this
we see the persist + flush pattern again to save the Bug into the
database.</p>
<p>See how simple relating Bug, Reporter, Engineer and Products is
done by using the discussed methods in the &#8220;A first prototype&#8221;
section. The UnitOfWork will detect this relationship when flush is
called and relate them in the database appropriately.</p>
</div>
<div class="section" id="queries-for-application-use-cases">
<h2>Queries for Application Use-Cases<a class="headerlink" href="#queries-for-application-use-cases" title="Permalink to this headline">¶</a></h2>
<div class="section" id="list-of-bugs">
<h3>List of Bugs<a class="headerlink" href="#list-of-bugs" title="Permalink to this headline">¶</a></h3>
<p>Using the previous examples we can fill up the database quite a
bit, however we now need to discuss how to query the underlying
mapper for the required view representations. When opening the
application, bugs can be paginated through a list-view, which is
the first read-only use-case:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// list_bugs.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$dql</span> <span class="o">=</span> <span class="s2">&quot;SELECT b, e, r FROM Bug b JOIN b.engineer e JOIN b.reporter r ORDER BY b.created DESC&quot;</span><span class="p">;</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="nv">$dql</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setMaxResults</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
<span class="nv">$bugs</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$bugs</span> <span class="k">as</span> <span class="nv">$bug</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot; - &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getCreated</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;d.m.Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">&quot;    Reported by: &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getReporter</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">&quot;    Assigned to: &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getEngineer</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getProducts</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;    Platform: &quot;</span><span class="o">.</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The DQL Query in this example fetches the 30 most recent bugs with
their respective engineer and reporter in one single SQL statement.
The console output of this script is then:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Something does not work! - 02.04.2010
    Reported by: beberlei
    Assigned to: beberlei
    Platform: My Product
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>DQL is not SQL</strong></p>
<p>You may wonder why we start writing SQL at the beginning of this
use-case. Don&#8217;t we use an ORM to get rid of all the endless
hand-writing of SQL? Doctrine introduces DQL which is best
described as <strong>object-query-language</strong> and is a dialect of
<a class="reference external" href="http://en.wikipedia.org/wiki/Object_Query_Language">OQL</a> and
similar to <a class="reference external" href="http://www.hibernate.org">HQL</a> or
<a class="reference external" href="http://en.wikipedia.org/wiki/Java_Persistence_Query_Language">JPQL</a>.
It does not know the concept of columns and tables, but only those
of Entity-Class and property. Using the Metadata we defined before
it allows for very short distinctive and powerful queries.</p>
<p>An important reason why DQL is favourable to the Query API of most
ORMs is its similarity to SQL. The DQL language allows query
constructs that most ORMs don&#8217;t: GROUP BY even with HAVING,
Sub-selects, Fetch-Joins of nested classes, mixed results with
entities and scalar data such as COUNT() results and much more.
Using DQL you should seldom come to the point where you want to
throw your ORM into the dumpster, because it doesn&#8217;t support some
the more powerful SQL concepts.</p>
<p>Instead of handwriting DQL you can use the <code class="docutils literal"><span class="pre">QueryBuilder</span></code> retrieved
by calling <code class="docutils literal"><span class="pre">$entityManager-&gt;createQueryBuilder()</span></code>. There are more
details about this in the relevant part of the documentation.</p>
<p class="last">As a last resort you can still use Native SQL and a description of the
result set to retrieve entities from the database. DQL boils down to a
Native SQL statement and a <code class="docutils literal"><span class="pre">ResultSetMapping</span></code> instance itself. Using
Native SQL you could even use stored procedures for data retrieval, or
make use of advanced non-portable database queries like PostgreSql&#8217;s
recursive queries.</p>
</div>
</div>
<div class="section" id="array-hydration-of-the-bug-list">
<h3>Array Hydration of the Bug List<a class="headerlink" href="#array-hydration-of-the-bug-list" title="Permalink to this headline">¶</a></h3>
<p>In the previous use-case we retrieved the results as their
respective object instances. We are not limited to retrieving
objects only from Doctrine however. For a simple list view like the
previous one we only need read access to our entities and can
switch the hydration from objects to simple PHP arrays instead.</p>
<p>Hydration can be an expensive process so only retrieving what you need can
yield considerable performance benefits for read-only requests.</p>
<p>Implementing the same list view as before using array hydration we
can rewrite our code:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// list_bugs_array.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$dql</span> <span class="o">=</span> <span class="s2">&quot;SELECT b, e, r, p FROM Bug b JOIN b.engineer e &quot;</span><span class="o">.</span>
       <span class="s2">&quot;JOIN b.reporter r JOIN b.products p ORDER BY b.created DESC&quot;</span><span class="p">;</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="nv">$dql</span><span class="p">);</span>
<span class="nv">$bugs</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getArrayResult</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$bugs</span> <span class="k">as</span> <span class="nv">$bug</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$bug</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot; - &quot;</span> <span class="o">.</span> <span class="nv">$bug</span><span class="p">[</span><span class="s1">&#39;created&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;d.m.Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">&quot;    Reported by: &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="p">[</span><span class="s1">&#39;reporter&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">&quot;    Assigned to: &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="p">[</span><span class="s1">&#39;engineer&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$bug</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;    Platform: &quot;</span><span class="o">.</span><span class="nv">$product</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There is one significant difference in the DQL query however, we
have to add an additional fetch-join for the products connected to
a bug. The resulting SQL query for this single select statement is
pretty large, however still more efficient to retrieve compared to
hydrating objects.</p>
</div>
<div class="section" id="find-by-primary-key">
<h3>Find by Primary Key<a class="headerlink" href="#find-by-primary-key" title="Permalink to this headline">¶</a></h3>
<p>The next Use-Case is displaying a Bug by primary key. This could be
done using DQL as in the previous example with a where clause,
however there is a convenience method on the <code class="docutils literal"><span class="pre">EntityManager</span></code> that
handles loading by primary key, which we have already seen in the
write scenarios:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// show_bug.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$theBugId</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nv">$bug</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s2">&quot;Bug&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$theBugId</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">&quot;Bug: &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;Engineer: &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getEngineer</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>The output of the engineer’s name is fetched from the database! What is happening?</p>
<p>Since we only retrieved the bug by primary key both the engineer and reporter
are not immediately loaded from the database but are replaced by LazyLoading
proxies. These proxies will load behind the scenes, when the first method
is called on them.</p>
<p>Sample code of this proxy generated code can be found in the specified Proxy
Directory, it looks like:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">MyProject\Proxies</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * THIS CLASS WAS GENERATED BY THE DOCTRINE ORM. DO NOT EDIT THIS FILE.</span>
<span class="sd"> **/</span>
<span class="k">class</span> <span class="nc">UserProxy</span> <span class="k">extends</span> <span class="nx">\User</span> <span class="k">implements</span> <span class="nx">\Doctrine\ORM\Proxy\Proxy</span>
<span class="p">{</span>
    <span class="c1">// .. lazy load code here</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addReportedBug</span><span class="p">(</span><span class="nv">$bug</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_load</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">addReportedBug</span><span class="p">(</span><span class="nv">$bug</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">assignedToBug</span><span class="p">(</span><span class="nv">$bug</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_load</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">assignedToBug</span><span class="p">(</span><span class="nv">$bug</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See how upon each method call the proxy is lazily loaded from the
database?</p>
<p>The call prints:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ php show_bug.php 1
Bug: Something does not work!
Engineer: beberlei
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Lazy loading additional data can be very convenient but the additional
queries create an overhead. If you know that certain fields will always
(or usually) be required by the query then you will get better performance
by explicitly retrieving them all in the first query.</p>
</div>
</div>
</div>
<div class="section" id="dashboard-of-the-user">
<h2>Dashboard of the User<a class="headerlink" href="#dashboard-of-the-user" title="Permalink to this headline">¶</a></h2>
<p>For the next use-case we want to retrieve the dashboard view, a
list of all open bugs the user reported or was assigned to. This
will be achieved using DQL again, this time with some WHERE clauses
and usage of bound parameters:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// dashboard.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$theUserId</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nv">$dql</span> <span class="o">=</span> <span class="s2">&quot;SELECT b, e, r FROM Bug b JOIN b.engineer e JOIN b.reporter r &quot;</span><span class="o">.</span>
       <span class="s2">&quot;WHERE b.status = &#39;OPEN&#39; AND (e.id = ?1 OR r.id = ?1) ORDER BY b.created DESC&quot;</span><span class="p">;</span>

<span class="nv">$myBugs</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="nv">$dql</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$theUserId</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">setMaxResults</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>

<span class="k">echo</span> <span class="s2">&quot;You have created or assigned to &quot;</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$myBugs</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; open bugs:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$myBugs</span> <span class="k">as</span> <span class="nv">$bug</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot; - &quot;</span> <span class="o">.</span> <span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="number-of-bugs">
<h2>Number of Bugs<a class="headerlink" href="#number-of-bugs" title="Permalink to this headline">¶</a></h2>
<p>Until now we only retrieved entities or their array representation.
Doctrine also supports the retrieval of non-entities through DQL.
These values are called &#8220;scalar result values&#8221; and may even be
aggregate values using COUNT, SUM, MIN, MAX or AVG functions.</p>
<p>We will need this knowledge to retrieve the number of open bugs
grouped by product:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// products.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$dql</span> <span class="o">=</span> <span class="s2">&quot;SELECT p.id, p.name, count(b.id) AS openBugs FROM Bug b &quot;</span><span class="o">.</span>
       <span class="s2">&quot;JOIN b.products p WHERE b.status = &#39;OPEN&#39; GROUP BY p.id&quot;</span><span class="p">;</span>
<span class="nv">$productBugs</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="nv">$dql</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getScalarResult</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$productBugs</span> <span class="k">as</span> <span class="nv">$productBug</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$productBug</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="s2">&quot; has &quot;</span> <span class="o">.</span> <span class="nv">$productBug</span><span class="p">[</span><span class="s1">&#39;openBugs&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot; open bugs!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-entities">
<h2>Updating Entities<a class="headerlink" href="#updating-entities" title="Permalink to this headline">¶</a></h2>
<p>There is a single use-case missing from the requirements, Engineers
should be able to close a bug. This looks like:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/Bug.php</span>

<span class="k">class</span> <span class="nc">Bug</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">close</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status</span> <span class="o">=</span> <span class="s2">&quot;CLOSE&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// close_bug.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$theBugId</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nv">$bug</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s2">&quot;Bug&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$theBugId</span><span class="p">);</span>
<span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>

<span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">flush</span><span class="p">();</span>
</pre></div>
</div>
<p>When retrieving the Bug from the database it is inserted into the
IdentityMap inside the UnitOfWork of Doctrine. This means your Bug
with exactly this id can only exist once during the whole request
no matter how often you call <code class="docutils literal"><span class="pre">EntityManager#find()</span></code>. It even
detects entities that are hydrated using DQL and are already
present in the Identity Map.</p>
<p>When flush is called the EntityManager loops over all the entities
in the identity map and performs a comparison between the values
originally retrieved from the database and those values the entity
currently has. If at least one of these properties is different the
entity is scheduled for an UPDATE against the database. Only the
changed columns are updated, which offers a pretty good performance
improvement compared to updating all the properties.</p>
</div>
<div class="section" id="entity-repositories">
<h2>Entity Repositories<a class="headerlink" href="#entity-repositories" title="Permalink to this headline">¶</a></h2>
<p>For now we have not discussed how to separate the Doctrine query logic from your model.
In Doctrine 1 there was the concept of <code class="docutils literal"><span class="pre">Doctrine_Table</span></code> instances for this
separation. The similar concept in Doctrine2 is called Entity Repositories, integrating
the <a class="reference external" href="http://martinfowler.com/eaaCatalog/repository.html">repository pattern</a> at the heart of Doctrine.</p>
<p>Every Entity uses a default repository by default and offers a bunch of convenience
methods that you can use to query for instances of that Entity. Take for example
our Product entity. If we wanted to Query by name, we can use:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;Product&#39;</span><span class="p">)</span>
                         <span class="o">-&gt;</span><span class="na">findOneBy</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$productName</span><span class="p">));</span>
</pre></div>
</div>
<p>The method <code class="docutils literal"><span class="pre">findOneBy()</span></code> takes an array of fields or association keys and the values to match against.</p>
<p>If you want to find all entities matching a condition you can use <code class="docutils literal"><span class="pre">findBy()</span></code>, for
example querying for all closed bugs:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$bugs</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;Bug&#39;</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="na">findBy</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CLOSED&#39;</span><span class="p">));</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$bugs</span> <span class="k">as</span> <span class="nv">$bug</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do stuff</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Compared to DQL these query methods are falling short of functionality very fast.
Doctrine offers you a convenient way to extend the functionalities of the default <code class="docutils literal"><span class="pre">EntityRepository</span></code>
and put all the specialized DQL query logic on it. For this you have to create a subclass
of <code class="docutils literal"><span class="pre">Doctrine\ORM\EntityRepository</span></code>, in our case a <code class="docutils literal"><span class="pre">BugRepository</span></code> and group all
the previously discussed query functionality in it:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// src/BugRepository.php</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\EntityRepository</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BugRepository</span> <span class="k">extends</span> <span class="nx">EntityRepository</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRecentBugs</span><span class="p">(</span><span class="nv">$number</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$dql</span> <span class="o">=</span> <span class="s2">&quot;SELECT b, e, r FROM Bug b JOIN b.engineer e JOIN b.reporter r ORDER BY b.created DESC&quot;</span><span class="p">;</span>

        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="nv">$dql</span><span class="p">);</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setMaxResults</span><span class="p">(</span><span class="nv">$number</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getRecentBugsArray</span><span class="p">(</span><span class="nv">$number</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$dql</span> <span class="o">=</span> <span class="s2">&quot;SELECT b, e, r, p FROM Bug b JOIN b.engineer e &quot;</span><span class="o">.</span>
               <span class="s2">&quot;JOIN b.reporter r JOIN b.products p ORDER BY b.created DESC&quot;</span><span class="p">;</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="nv">$dql</span><span class="p">);</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">setMaxResults</span><span class="p">(</span><span class="nv">$number</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">getArrayResult</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUsersBugs</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$number</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$dql</span> <span class="o">=</span> <span class="s2">&quot;SELECT b, e, r FROM Bug b JOIN b.engineer e JOIN b.reporter r &quot;</span><span class="o">.</span>
               <span class="s2">&quot;WHERE b.status = &#39;OPEN&#39; AND e.id = ?1 OR r.id = ?1 ORDER BY b.created DESC&quot;</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="nv">$dql</span><span class="p">)</span>
                             <span class="o">-&gt;</span><span class="na">setParameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$userId</span><span class="p">)</span>
                             <span class="o">-&gt;</span><span class="na">setMaxResults</span><span class="p">(</span><span class="nv">$number</span><span class="p">)</span>
                             <span class="o">-&gt;</span><span class="na">getResult</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOpenBugsByProduct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$dql</span> <span class="o">=</span> <span class="s2">&quot;SELECT p.id, p.name, count(b.id) AS openBugs FROM Bug b &quot;</span><span class="o">.</span>
               <span class="s2">&quot;JOIN b.products p WHERE b.status = &#39;OPEN&#39; GROUP BY p.id&quot;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="nv">$dql</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getScalarResult</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To be able to use this query logic through <code class="docutils literal"><span class="pre">$this-&gt;getEntityManager()-&gt;getRepository('Bug')</span></code>
we have to adjust the metadata slightly.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * @Entity(repositoryClass=&quot;BugRepository&quot;)</span>
<span class="sd"> * @Table(name=&quot;bugs&quot;)</span>
<span class="sd"> **/</span>
<span class="k">class</span> <span class="nc">Bug</span>
<span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;doctrine-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping&quot;</span>
      <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://doctrine-project.org/schemas/orm/doctrine-mapping</span>
<span class="s">                    http://raw.github.com/doctrine/doctrine2/master/doctrine-mapping.xsd&quot;</span><span class="nt">&gt;</span>

      <span class="nt">&lt;entity</span> <span class="na">name=</span><span class="s">&quot;Bug&quot;</span> <span class="na">table=</span><span class="s">&quot;bugs&quot;</span> <span class="na">repository-class=</span><span class="s">&quot;BugRepository&quot;</span><span class="nt">&gt;</span>

      <span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/doctrine-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Bug</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">entity</span>
  <span class="l l-Scalar l-Scalar-Plain">repositoryClass</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">BugRepository</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Now we can remove our query logic in all the places and instead use them through the EntityRepository.
As an example here is the code of the first use case &#8220;List of Bugs&#8221;:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// list_bugs_repository.php</span>
<span class="k">require_once</span> <span class="s2">&quot;bootstrap.php&quot;</span><span class="p">;</span>

<span class="nv">$bugs</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;Bug&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getRecentBugs</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$bugs</span> <span class="k">as</span> <span class="nv">$bug</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getDescription</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot; - &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getCreated</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;d.m.Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">&quot;    Reported by: &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getReporter</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">&quot;    Assigned to: &quot;</span><span class="o">.</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getEngineer</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$bug</span><span class="o">-&gt;</span><span class="na">getProducts</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;    Platform: &quot;</span><span class="o">.</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using EntityRepositories you can avoid coupling your model with specific query logic.
You can also re-use query logic easily throughout your application.</p>
<p>The method <code class="docutils literal"><span class="pre">count()</span></code> takes an array of fields or association keys and the values to match against.
This provides you with a convenient and lightweight way to count a resultset when you don&#8217;t need to
deal with it:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$productCount</span> <span class="o">=</span> <span class="nv">$entityManager</span><span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="nx">Product</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
                         <span class="o">-&gt;</span><span class="na">count</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$productName</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is over here, I hope you had fun. Additional content
will be added to this tutorial incrementally, topics will include:</p>
<ul class="simple">
<li>More on Association Mappings</li>
<li>Lifecycle Events triggered in the UnitOfWork</li>
<li>Ordering of Collections</li>
</ul>
<p>Additional details on all the topics discussed here can be found in
the respective manual chapters.</p>
</div>
</div>


              </div>
                </div>

            </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
             
                <h3>Project Versions</h3>

                <select name="versions" id="versions">
            
            <option value="http://readthedocs.org/en/latest/">latest</option>
            
            <option value="http://readthedocs.org/en/stable/">stable</option>
            
                </select>
            
            <div id="searchbox" style="">
              <h3>Search</h3>
                <form class="search" action="http://readthedocs.org/search/project/" method="get">
                  <input type="text" name="q" size="18">
                  <input type="submit" value="Go">
                  <input type="hidden" name="selected_facets" value="project:Doctrine ORM">
                </form>
            </div>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Getting Started with Doctrine</a><ul>
<li><a class="reference internal" href="#guide-assumptions">Guide Assumptions</a></li>
<li><a class="reference internal" href="#what-is-doctrine">What is Doctrine?</a><ul>
<li><a class="reference internal" href="#what-are-entities">What are Entities?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#an-example-model-bug-tracker">An Example Model: Bug Tracker</a></li>
<li><a class="reference internal" href="#project-setup">Project Setup</a></li>
<li><a class="reference internal" href="#obtaining-the-entitymanager">Obtaining the EntityManager</a></li>
<li><a class="reference internal" href="#generating-the-database-schema">Generating the Database Schema</a></li>
<li><a class="reference internal" href="#starting-with-the-product">Starting with the Product</a></li>
<li><a class="reference internal" href="#adding-bug-and-user-entities">Adding Bug and User Entities</a></li>
<li><a class="reference internal" href="#implementing-more-requirements">Implementing more Requirements</a></li>
<li><a class="reference internal" href="#queries-for-application-use-cases">Queries for Application Use-Cases</a><ul>
<li><a class="reference internal" href="#list-of-bugs">List of Bugs</a></li>
<li><a class="reference internal" href="#array-hydration-of-the-bug-list">Array Hydration of the Bug List</a></li>
<li><a class="reference internal" href="#find-by-primary-key">Find by Primary Key</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dashboard-of-the-user">Dashboard of the User</a></li>
<li><a class="reference internal" href="#number-of-bugs">Number of Bugs</a></li>
<li><a class="reference internal" href="#updating-entities">Updating Entities</a></li>
<li><a class="reference internal" href="#entity-repositories">Entity Repositories</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../index.html"
                                  title="previous chapter">Welcome to Doctrine 2 ORM&#8217;s documentation!</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="getting-started-database.html"
                                  title="next chapter">Getting Started: Database First</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/tutorials/getting-started.rst.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
        </div>
      </div>
          <div class="clearer"></div>
        </div>
          <div class="footer">
              &copy; Copyright 2010-%y, Doctrine Project Team.
              Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5.3.
            <br/>
            <a target="_BLANK" href="http://www.servergrove.com"><img src="http://www.doctrine-project.org/images/servergrove.jpg" /></a>      <br/><br/>
            <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
              <input type="hidden" name="cmd" value="_s-xclick" />
              <input type="hidden" name="hosted_button_id" value="BAE2E3XANQ77Y" />
              <input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!" />
              <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
            </form>
          </div>
      </div>

      <div id="bot-rcnr">
        <div class="tl"><!-- corner --></div>
      </div>
    </div>

  <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
  </script>
  <script type="text/javascript">
  _uacct = "UA-288343-7";
  urchinTracker();
  </script>
  <a class="githublink" href="http://github.com/doctrine"><img src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  </body>
</html>